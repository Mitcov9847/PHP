# Итоговый отчет по проекту "Recipe Book"

## Введение

Проект "Recipe Book" представляет собой веб-приложение для управления рецептами. В процессе работы над проектом были реализованы основные принципы архитектуры с единой точкой входа, использование шаблонов для визуализации страниц, а также переход от хранения данных в файле к использованию базы данных (MySQL). Этот отчет охватывает все ключевые аспекты разработки приложения, включая подготовку среды, проектирование базы данных, архитектуру приложения, обработку запросов и работу с шаблонами.

### Цель работы

Целью работы было освоить архитектуру с единой точкой входа, подключение шаблонов для визуализации страниц, а также переход от хранения данных в файле к использованию базы данных (MySQL). В рамках работы была реализована CRUD-функциональность для управления рецептами, внедрены механизмы защиты от SQL-инъекций и оптимизации работы с данными.

---

## 1. Подготовка среды

Для начала работы с проектом был установлен сервер MySQL с помощью XAMPP, который предоставляет удобную среду для разработки. На этом сервере была создана база данных с названием `recipe_book`, в которой были созданы две основные таблицы: `recipes` и `categories`.

### Структура таблиц:

#### Таблица `recipes`
```sql
CREATE TABLE recipes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  category INT NOT NULL,
  ingredients TEXT,
  description TEXT,
  tags TEXT,
  steps TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (category) REFERENCES categories(id) ON DELETE CASCADE
);
```
Таблица categories
```
sql
Копировать
Редактировать
CREATE TABLE categories (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
Это основа для хранения информации о рецептах и категориях, к которым они относятся. База данных позволяет хранить информацию о каждом рецепте, включая название, ингредиенты, шаги приготовления и теги, а также позволяет структурировать рецепты по категориям.

## 2. Архитектура и маршрутизация
Единая точка входа
В приложении используется единая точка входа — файл index.php, который обрабатывает все входящие HTTP-запросы. В этом файле настроена базовая маршрутизация, которая перенаправляет запросы на соответствующие обработчики. Например:

Запрос на главную страницу (/) будет отображать все рецепты.

Запрос на страницу создания нового рецепта (/create) будет показывать форму для добавления рецепта.

Запрос на страницу с подробной информацией о рецепте (/recipe/{id}) будет показывать данные о конкретном рецепте.

Пример маршрутизации в index.php:

php
Копировать
Редактировать
switch ($action) {
    case 'create':
        include 'src/handlers/recipe/create.php';
        break;
    case 'edit':
        include 'src/handlers/recipe/edit.php';
        break;
    case 'delete':
        include 'src/handlers/recipe/delete.php';
        break;
    default:
        include 'src/handlers/recipe/index.php';
        break;
}
Шаблонная система
Для упрощения визуализации и разделения логики представления и данных была использована система шаблонов. Все страницы приложения используют один базовый шаблон — layout.php. Этот шаблон отвечает за общую структуру страницы, включая заголовки, навигацию и футер. Отдельные страницы, такие как главная страница, создание рецепта и просмотр рецепта, наследуют этот шаблон и заполняют его данными.

Структура шаблонов:
templates/layout.php — основной макет для всех страниц.

templates/index.php — шаблон для отображения списка рецептов.

templates/recipe/create.php — форма для создания нового рецепта.

templates/recipe/edit.php — форма для редактирования рецепта.

templates/recipe/show.php — шаблон для отображения подробной информации о рецепте.

Пример базового шаблона (layout.php):

php
Копировать
Редактировать
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title><?= $title ?? 'Recipe Book' ?></title>
</head>
<body>
    <nav>
        <a href="/">Главная</a>
        <a href="/create">Создать рецепт</a>
    </nav>

    <div>
        <?= $content ?>
    </div>
</body>
</html>
## 3. Работа с базой данных
Для подключения к базе данных использовался PDO (PHP Data Objects), который является безопасным и гибким способом работы с базами данных в PHP. Для инкапсуляции логики работы с базой данных была создана функция подключения в src/db.php, а параметры подключения хранятся в конфигурационном файле config/db.php.

Пример подключения к базе данных через PDO:

php
Копировать
Редактировать
function getDbConnection() {
    $dsn = 'mysql:host=localhost;dbname=recipe_book;charset=utf8';
    $username = 'root';
    $password = '';
    
    try {
        $pdo = new PDO($dsn, $username, $password);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        return $pdo;
    } catch (PDOException $e) {
        die('Ошибка подключения: ' . $e->getMessage());
    }
}
Реализация CRUD-функциональности
В проекте была реализована полная функциональность для работы с рецептами:

Добавление рецепта — обработчик в handlers/recipe/create.php, который принимает данные формы и добавляет их в базу данных.

Редактирование рецепта — обработчик в handlers/recipe/edit.php, который позволяет редактировать уже существующий рецепт.

Удаление рецепта — обработчик в handlers/recipe/delete.php, который удаляет рецепт из базы данных.

Пример кода для создания рецепта:

php
Копировать
Редактировать
$stmt = $pdo->prepare('INSERT INTO recipes (title, category, ingredients, description, tags, steps) VALUES (:title, :category, :ingredients, :description, :tags, :steps)');
$stmt->execute([
    'title' => $_POST['title'],
    'category' => $_POST['category'],
    'ingredients' => $_POST['ingredients'],
    'description' => $_POST['description'],
    'tags' => $_POST['tags'],
    'steps' => $_POST['steps'],
]);
## 4. Защита от SQL-инъекций
В проекте были приняты меры по защите от SQL-инъекций. Основным методом защиты является использование подготовленных выражений (prepared statements) при выполнении SQL-запросов. Это позволяет безопасно передавать данные в запросы без риска их вмешательства в структуру SQL-запроса.

Пример защищенного SQL-запроса:

php
Копировать
Редактировать
$stmt = $pdo->prepare('INSERT INTO recipes (title, category, ingredients, description, tags, steps) VALUES (:title, :category, :ingredients, :description, :tags, :steps)');
$stmt->execute([
    'title' => $_POST['title'],
    'category' => $_POST['category'],
    'ingredients' => $_POST['ingredients'],
    'description' => $_POST['description'],
    'tags' => $_POST['tags'],
    'steps' => $_POST['steps'],
]);
Все данные, полученные от пользователя, проверяются и фильтруются перед тем, как они будут вставлены в базу данных. Это исключает возможность SQL-инъекций, так как подготовленные выражения не позволяют злоумышленнику вмешиваться в структуру запроса.

## 5. Документация кода
Каждый файл и функция были задокументированы с использованием PHPDoc, чтобы обеспечить понимание кода другим разработчикам. Каждый метод имеет описание его назначения, параметров и возвращаемых значений.

Пример документации для метода подключения к базе данных:

php
Копировать
Редактировать
/**
 * Устанавливает подключение к базе данных с использованием PDO.
 *
 * @return PDO Экземпляр объекта PDO для работы с базой данных.
 */
function getDbConnection() {
    // реализация
}

## Контрольные вопросы
Какие преимущества даёт использование единой точки входа в веб-приложении?
Использование единой точки входа (например, index.php) помогает централизовать обработку всех входящих запросов, упрощая маршрутизацию и организацию логики приложения. Это облегчает управление контроллерами и шаблонами, а также повышает масштабируемость приложения.

Какие преимущества даёт использование шаблонов?
Шаблоны помогают разделить логику обработки данных и представление. Это улучшает читаемость и поддержку кода, а также позволяет повторно использовать части интерфейса на разных страницах приложения. Система шаблонов упрощает работу с HTML и делает приложение более гибким.

Какие преимущества даёт хранение данных в базе по сравнению с хранением в файлах?
Хранение данных в базе данных позволяет легко управлять большими объемами информации, осуществлять сложные запросы, поддерживать целостность данных и гарантировать быстрый доступ. В отличие от файлов, базы данных поддерживают индексацию, поиск, и могут обеспечить большую степень безопасности и масштабируемости.

Что такое SQL-инъекция? Придумайте пример SQL-инъекций и объясните, как её предотвратить.
SQL-инъекция — это метод атаки на веб-приложение, при котором злоумышленник вставляет или "внедряет" вредоносный SQL-код в запросы к базе данных. Пример инъекции: если поле для ввода имени пользователя в форме не защищено, можно ввести что-то вроде admin' OR 1=1 --, что приведет к выполнению запроса, который вернет все данные из таблицы. Чтобы предотвратить SQL-инъекции, необходимо использовать подготовленные выражения (prepared statements) и тщательно проверять и фильтровать входные данные.

## Заключение
Проект "Recipe Book" представляет собой функциональное веб-приложение для управления рецептами, в котором реализованы все основные функции CRUD, защита от SQL-инъекций, пагинация и шаблонная система. Все данные хранятся в базе данных, что значительно упрощает управление ими по сравнению с использованием файловой системы. Приложение имеет хорошо организованную архитектуру с единой точкой входа и использует передовые практики разработки, такие как подготовленные выражения, инкапсуляция работы с базой данных и использование шаблонов для представления данных.
